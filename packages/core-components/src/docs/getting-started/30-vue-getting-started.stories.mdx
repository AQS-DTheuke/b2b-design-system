import { Meta, Source } from '@storybook/addon-docs';
import dedent from 'ts-dedent';

<Meta title="Getting Started/Vue" />

# Vue Support

Our web components are supported by vue out of the box.
In this guide you can find:

- [Vue Installation and usage](#vue-installation-and-usage)
- [How to use b2b-core-components in Vue 3](#how-to-use-b2b-core-components-in-vue-3)
- [How to use b2b-core-components in Vue 2](#how-to-use-b2b-core-components-in-vue-2)
- [About Web Components 'slots'](#about-web-components-slots)
- [V-Model Support](#v-model-support)

<br />

## Vue Installation and usage

You can use web components in Vue by installing the package [b2b-core-components](https://github.com/otto-ec/b2b-design-system/packages/1267319) \*

```
npm install @otto-de/b2b-core-components
```

_\*This is currently hosted in GitHub packages withing the Otto organisation, therefore it requires an authentication
token to be able to install. Follow [this guide](?path=/story/getting-started-package-installation--page)
if you haven't configured this yet._

The distribution of this package exposes web-components that are natively supported by Vue, but we still need to
do a very simple configuration in your project to make them available:

<br />

## How to use b2b-core-components in Vue 3

**1.** In your `main.ts/.js` file, please copy the following configuration.

```ts
import { defineCustomElements } from '@otto-de/b2b-core-components/loader';

defineCustomElements(window).catch(err => console.log('Log your error', err));
```

`defineCustomElements()` binds the Stenciljs component code to the window object.

**2.** In your `vite configuration` add the following:

```js
export default defineConfig({
  plugins: [
    vue({
      template: {
        compilerOptions: {
          isCustomElement: tag => tag.startsWith('b2b'),
        },
      },
    }),
    vueJsx(),
  ],
});
```

## How to use b2b-core-components in Vue 2

In your `main.ts/.js` file, please copy the following configuration.

```ts
import { defineCustomElements } from '@otto-de/b2b-core-components/loader';

defineCustomElements(window).catch(err => console.log('Log your error', err));

Vue.config.ignoredElements = [/^b2b/];
```

`defineCustomElements()` binds the Stenciljs component code to the window object.

`ignoredElements` Configures Vue to ignore custom elements defined outside Vue (e.g., using the Web Components APIs).
[Reference](https://v2.vuejs.org/v2/api/#ignoredElements)

<br />

## About Web Components `slots`

Vue exposes a slot attribute that is currently used as `v-slot`, and a normal eslint setup might warn against the usage
of the web components `slot` attribute as deprecated, but is a valid use case, and you will encounter named slots
usage for the Design System. If you are seeing these warnings, please consider disabling them by adding a new rule to
your eslint:

```
// .eslintrc.js
module.exports = {
  rules: {
    'vue/no-deprecated-slot-attribute': 'off',
  }
}
```

For mor information you can follow [this link](https://stackoverflow.com/questions/65913547/ionic-slot-attributes-are-deprecated-eslint-plugin-vue).

<br />

## V-Model Support

The `v-model` directive for two-way data binding is currently compatible with all our form components but the
`b2b-drowpdown`, for which we recommend using the `v-on` directive.

To learn more about v-model, we recommend following [this guide](https://vuejs.org/guide/essentials/forms.html).
We have published some examples of our components with the V-Model notation. You can find them in our [example
repository](https://github.com/otto-ec/b2b-vue-examples/blob/main/src/App.vue).

If you encounter a problem with this directive, let us know by [opening an issue](https://github.com/otto-ec/b2b-design-system/issues) in GitHub, and also consider using an
extended `v-on` directive such as:

<Source
  language="tsx"
  format={false}
  code={dedent`
    <b2b-input
     :value="firstName"
     v-on:b2b-input="event => (firstName = event.target.value)"
    ></b2b-input>
  `}
/>

For more information, please have a look at the full code in our [extended notation example](https://github.com/otto-ec/b2b-vue-examples/blob/main/src/components/input/InputEventNotation.vue) and [v-model example](https://github.com/otto-ec/b2b-vue-examples/blob/main/src/components/input/InputVModelNotation.vue) or
check out the open issue on GitHub [here](https://github.com/vuejs/vue/issues/7830).
